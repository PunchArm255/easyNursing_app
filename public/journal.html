<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyNursing - Journal</title>
    <link rel="stylesheet" href="https://cdn.tailwindcss.com">
    <style>
      @font-face {
        font-family: 'RedHatDisplay';
        src: url('./fonts/RedHatDisplay-Black.ttf') format('truetype');
        font-weight: bold;
        font-style: normal;
      }

      body {
        font-family: 'RedHatDisplay', sans-serif;
      }

      .scale-0 {
        transform: scale(0);
      }
      .scale-100 {
        transform: scale(1);
      }
      .modal-enter {
        opacity: 0;
      }
      .modal-active {
        opacity: 1;
        backdrop-filter: blur(8px);
        transition: opacity 0.3s ease, backdrop-filter 0.3s ease;
      }
      .modal-content-active {
        transition: transform 0.3s ease;
      }
      .modal-exit {
        opacity: 0;
        transition: opacity 0.3s ease, backdrop-filter 0.3s ease;
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#f7f7f7] flex justify-start items-start h-screen">

<!-- Sidebar -->
<div class="bg-[#5e67ac] w-[80px] h-screen rounded-tr-[40px] rounded-br-[40px] flex flex-col justify-between fixed left-0 top-0 py-[30px]"
     style="box-shadow: 0 0 40px 1px #5e67ac;">
    <img src="assets/plus.svg" alt="Add Icon" class="w-[40px] mx-auto mb-auto">
    <div class="flex flex-col gap-[30px] pb-[20px]">
        <img src="assets/user.svg" alt="User Icon" class="w-[40px] mx-auto">
        <img src="assets/settings.svg" alt="Settings Icon" class="w-[40px] mx-auto">
    </div>
</div>

<!-- Main Content -->
<div class="flex-1 ml-[100px] px-10 py-8">

    <!-- Journal Title -->
    <h1 class="text-5xl font-bold text-[#5e67ac] mb-6">
      Journal
    </h1>

    <!-- Buttons -->
    <div class="w-full flex justify-between mb-8">
        <button id="addTaskBtn" class="bg-[#cbd1ff] text-[#5e67ac] rounded-full py-2 px-6">
          Ajouter une tache
        </button>
        <button class="bg-[#5e67ac] text-[#cbd1ff] rounded-full py-2 px-6"
                onclick="window.location.href='index.html'">
          Retour a l'accueil
        </button>
    </div>

    <!-- Task Box -->
    <div class="w-full h-[550px] bg-[#f1f3ff] rounded-3xl p-4 overflow-y-auto" id="taskContainer"
    style="box-shadow: 0 0 50px 0.1px #cbd1ff;">
      <!-- Dynamically added tasks will go here -->
    </div>
</div>

<!-- Modal (hidden by default) -->
<div id="taskModal" class="fixed inset-0 bg-[#5e67ac] bg-opacity-30 modal-enter hidden flex justify-center items-center modal-active">
  <div class="bg-[#cbd1ff] p-6 rounded-3xl shadow-lg w-[500px] transform transition-transform duration-300 scale-0 modal-content-active">
    <h2 id="modalTitle" class="text-2xl font-bold mb-2 ml-1 text-[#5e67ac]">Ajouter une tâche</h2>
    <input type="text" id="taskName" class="w-full bg-[#f1f3ff] text-[#5e67ac] rounded-lg p-2 mb-4" placeholder="Nom de la tâche">
    <div class="mb-4">
      <label class="mr-4 text-[#5e67ac]">Type de tâche:</label>
      <select id="taskType" class="border bg-[#f1f3ff] rounded-lg p-2 text-red-400">
        <option value="1" class="text-red-400">Examens Paracliniques</option>
        <option value="2" class="text-green-300">Traitement Recu</option>
      </select>
    </div>

      <div class="flex space-x-2 justify-end">
        <button id="saveTaskBtn" class="bg-[#5e67ac] text-[#cbd1ff] rounded-full py-2 px-4">
          Enregistrer
        </button>
        <button id="deleteTaskBtn" class="bg-[#d55e5e] text-[#ffe1e1] rounded-full py-2 px-4 hidden">
          Supprimer
        </button>
        <button id="cancelBtn" class="bg-[#f1f3ff] text-[#5e67ac] rounded-full py-2 px-4">
          Annuler
        </button>
      </div>
  </div>
</div>

<script>
  let editingTask = null; // Reference to the task being edited

  const addTaskBtn = document.getElementById('addTaskBtn');
  const taskModal = document.getElementById('taskModal');
  const cancelBtn = document.getElementById('cancelBtn');
  const saveTaskBtn = document.getElementById('saveTaskBtn');
  const taskNameInput = document.getElementById('taskName');
  const taskTypeInput = document.getElementById('taskType');
  const taskContainer = document.getElementById('taskContainer');
  const modalContent = taskModal.querySelector('div');
  const deleteTaskBtn = document.getElementById('deleteTaskBtn');
  const modalTitle = document.getElementById('modalTitle');

  addTaskBtn.addEventListener('click', () => {
    resetModal();
    taskModal.classList.remove('hidden', 'modal-enter');
    taskModal.classList.add('modal-active');
    setTimeout(() => {
      modalContent.classList.remove('scale-0');
      modalContent.classList.add('scale-100');
    }, 10);
  });

  cancelBtn.addEventListener('click', closeModal);

  saveTaskBtn.addEventListener('click', () => {
    const taskName = taskNameInput.value.trim();
    const taskType = taskTypeInput.value;

    if (taskName !== "") {
      if (editingTask) {
        // Update existing task
        editingTask.innerText = ' + ' + taskName;
        editingTask.style.backgroundColor = taskType === '1' ? '#ffd3d3' : '#d3ffda';
        editingTask.classList.toggle('text-[#ac5e5e]', taskType === '1');
        editingTask.classList.toggle('text-[#437d4f]', taskType === '2');
      } else {
        // Create a new task
        const taskDiv = document.createElement('div');
        taskDiv.classList.add('p-2', 'mb-2', 'rounded-2xl', taskType === '1' ? 'text-[#ac5e5e]' : 'text-[#437d4f]');
        taskDiv.style.backgroundColor = taskType === '1' ? '#ffd3d3' : '#d3ffda';
        taskDiv.innerText = ' + ' + taskName;
        taskDiv.addEventListener('click', () => editTask(taskDiv));
        taskContainer.appendChild(taskDiv);
      }

      closeModal();
    }
  });

  deleteTaskBtn.addEventListener('click', () => {
    if (editingTask) {
      editingTask.remove(); // Remove the task from DOM
      closeModal();
    }
  });

  function closeModal() {
    modalContent.classList.remove('scale-100');
    modalContent.classList.add('scale-0');
    taskModal.classList.remove('modal-active');
    taskModal.classList.add('modal-exit');
    setTimeout(() => {
      taskModal.classList.add('hidden');
      taskModal.classList.remove('modal-exit');
      resetModal(); // Reset modal state after closing
    }, 300);
  }

  function editTask(taskDiv) {
    // Set the modal for editing mode
    editingTask = taskDiv;
    taskNameInput.value = taskDiv.innerText.trim().slice(2); // Remove leading ' + ' from task name
    taskTypeInput.value = taskDiv.classList.contains('text-[#ac5e5e]') ? '1' : '2';
    taskModal.classList.remove('hidden', 'modal-enter');
    taskModal.classList.add('modal-active');
    deleteTaskBtn.classList.remove('hidden'); // Show the delete button for editing
    modalTitle.innerText = 'Modifier une tâche';
    setTimeout(() => {
      modalContent.classList.remove('scale-0');
      modalContent.classList.add('scale-100');
    }, 10);
  }

  function resetModal() {
    taskNameInput.value = '';
    taskTypeInput.value = '1'; // Default task type
    editingTask = null; // Reset the editing task
    deleteTaskBtn.classList.add('hidden'); // Hide the delete button for new task
    modalTitle.innerText = 'Ajouter une tâche';
  }

  taskTypeInput.addEventListener('change', () => {
    if (taskTypeInput.value === '1') {
      taskTypeInput.classList.remove('text-green-300');
      taskTypeInput.classList.add('text-red-400');
    } else if (taskTypeInput.value === '2') {
      taskTypeInput.classList.remove('text-red-400');
      taskTypeInput.classList.add('text-green-300');
    }
  });
</script>
</body>
</html>
